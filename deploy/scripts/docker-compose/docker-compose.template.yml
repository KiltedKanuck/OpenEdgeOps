version: "3.6"
services:
    oedbmachine:
      image: oedb:latest
      ports:
        - "7654:7654"
        - "7664-7684:7664-7684"
      environment:
        - DB_BROKER_PORT=7654
        - DB_MINPORT=7664 
        - DB_MAXPORT=7684
    web:
      image: nginx
      ports:
      - "8080:80"
      volumes:
      - ${WEB.UI.DIR}:/usr/share/nginx/html:ro
    jdk:
        image: ${JDK.DOCKER.IMAGE.FULLNAME}
        volumes:
          - ${JDK.VOLUME}:${JDK.DOCKER.IMAGE.JAVA.LOCATION}
    ablapp:
        image: ${APP.DOCKER.IMAGE.FULLNAME}
        volumes:
          - ${APP.VOLUME}:/deploy-staging/artifacts
    pasoeinstance:
        image: ${PASOE.DOCKER.IMAGE.FULLNAME}
        depends_on: 
          - jdk
          - ablapp
        environment:
          - FLUENTBIT_LOGGING=${FLUENTBIT.LOGGING}
          - APP_NAME=${APP.NAME}
          - INSTANCE_NAME=${PAS.INSTANCE.NAME}
        ports:
          - "${PASOE.HTTPS.PORT}:8811"
        container_name: "${PAS.INSTANCE.NAME}_pasoeinstance_dc"
        command: ["/bin/sh", "-c", "sh /deploy/scripts/startServer.sh"]
        volumes:
          - type: volume
            source: ${JDK.VOLUME}
            target: /usr/java
            volume:
              nocopy: true
          - type: volume
            source: ${APP.VOLUME}
            target: /deploy/artifacts
            volume:
              nocopy: true
          - ${LICENSE.FILE}:/psc/dlc/progress.cfg
          - ${RUNTIME.CONFIG}:/deploy/scripts/config/runtime.properties
          - ${LOGGING.CONF.DIR}:/fluentbit-tlr
          - /mnt/c/Users/rahulk/work/pug2023/pasoe-docker/deployScripts/deploy/startServer.sh:/deploy/scripts/startServer.sh
volumes:
    ${JDK.VOLUME}:
    ${APP.VOLUME}:
